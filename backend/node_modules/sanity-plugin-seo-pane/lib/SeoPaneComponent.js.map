{"version":3,"file":"SeoPaneComponent.js","names":["SeoPaneComponent","sanityDocument","document","options","useState","tab","setTab","useQuery","_rev","_id","Error","url","badOption","Promise","all","asyncCall","keywords","synonyms","get","performSeoReview","keepPreviousData","data","isLoading","error","errorMessage","message","stack","JSON","stringify","meta","permalink","resultsMapped","title","description","Object","keys","map","key","tabIndex","length","resultsLabels","single","plural","panelIndex","margin","padding","result","resultIndex","borderRadius","width","height","backgroundColor","renderRatingToColor","rating","marginRight","flexShrink","transform","text","__html","propTypes","PropTypes","shape","displayed","string","isRequired","oneOfType","func"],"sources":["../src/SeoPaneComponent.js"],"sourcesContent":["import React, {useState} from 'react'\nimport PropTypes from 'prop-types'\nimport {Text, Stack, Box, Card, Label, Flex, TabList, Tab, TabPanel, Spinner} from '@sanity/ui'\nimport {useQuery} from 'react-query'\nimport get from 'lodash/get'\n\nimport asyncCall from './lib/asyncCall'\nimport performSeoReview from './lib/performSeoReview'\nimport {renderRatingToColor} from './lib/renderRatingToColor'\nimport {resultsLabels} from './lib/resultsLabels'\n\nimport ErrorStack from './ErrorStack.js'\nimport SerpPreview from './SerpPreview.js'\nimport Feedback from './Feedback'\n\nexport default function SeoPaneComponent({document: sanityDocument, options}) {\n  const [tab, setTab] = useState('')\n\n  // The `revision` key updates when the document does, refreshing the query\n  const {data, isLoading, error} = useQuery(\n    [`seoReview`, sanityDocument._rev],\n    async () => {\n      if (!sanityDocument._id) throw new Error('Document is not published')\n      else if (!options.url) badOption('url')\n\n      let [keywords, synonyms, url] = await Promise.all([\n        asyncCall(options.keywords, sanityDocument),\n        asyncCall(options.synonyms, sanityDocument),\n        asyncCall(options.url, sanityDocument),\n      ])\n\n      // Visits document path when strings because the asyncCall will have same value as options\n      if (keywords && keywords === options.keywords) keywords = get(sanityDocument, keywords)\n      if (synonyms && synonyms === options.synonyms) synonyms = get(sanityDocument, synonyms)\n\n      // Tack on keywords and synonyms to seo review response since we use them.\n      return {\n        ...(await performSeoReview(url, keywords, synonyms)),\n        keywords,\n        synonyms,\n      }\n    },\n    {keepPreviousData: true}\n  )\n\n  // Will only show on the first render because of `keepPreviousData` above\n  if (isLoading) {\n    return (\n      <Flex align=\"center\" justify=\"center\" padding={4}>\n        <Spinner muted />\n      </Flex>\n    )\n  }\n\n  // Bail out on error. Unfortunately can't JSON.stringify(Error) to get the stack/message.\n  let errorMessage\n  if (error instanceof Error) {\n    errorMessage = (\n      <>\n        {error.message} <ErrorStack stack={error.stack} />\n      </>\n    )\n  } else if (!data) errorMessage = 'Empty response'\n  else if (data.error) errorMessage = <pre>{JSON.stringify(data.error)}</pre>\n\n  if (errorMessage) {\n    return <Feedback isError>Error: {errorMessage}</Feedback>\n  }\n\n  const {keywords, meta, permalink, resultsMapped, synonyms} = data\n\n  return (\n    <Box padding={4}>\n      <Flex direction=\"column\">\n        {meta?.title && (\n          <Card border padding={4} radius={2}>\n            <SerpPreview\n              title={meta?.title}\n              metaDescription={meta?.description ?? ``}\n              url={permalink}\n            />\n          </Card>\n        )}\n\n        <Flex paddingY={4}>\n          <Stack space={3}>\n            <Label muted size={1}>\n              Keywords\n            </Label>\n            <Text size={2}>{keywords ? `\"${keywords}\"` : `Not Defined`}</Text>\n          </Stack>\n          <Stack space={3} marginLeft={6}>\n            <Label muted size={1}>\n              Synonyms\n            </Label>\n            <Text size={2}>{synonyms ? `\"${synonyms}\"` : `Not Defined`}</Text>\n          </Stack>\n        </Flex>\n\n        <TabList space={1}>\n          {Object.keys(resultsMapped).map((key, tabIndex) => (\n            <Tab\n              aria-controls={key}\n              key={`${key}-button`}\n              id={`${key}-button`}\n              label={`${resultsMapped[key].length} ${\n                resultsMapped[key].length === 1\n                  ? resultsLabels[key].single\n                  : resultsLabels[key].plural\n              }`}\n              // eslint-disable-next-line react/jsx-no-bind\n              onClick={() => setTab(key)}\n              selected={tab === key || (!tab && !tabIndex)}\n              space={2}\n            />\n          ))}\n        </TabList>\n\n        {Object.keys(resultsMapped).map((key, panelIndex) => (\n          <TabPanel\n            aria-labelledby={key}\n            hidden={(tab && tab !== key) || (!tab && panelIndex)}\n            key={`${key}-panel`}\n            id={`${key}-panel`}\n            style={{margin: `0.5rem 0`, padding: `0.5rem 0`}}\n          >\n            {resultsMapped[key].map((result, resultIndex) => (\n              <Flex key={`result-${resultIndex}`} alignItems=\"center\" style={{margin: `0.5rem 0`}}>\n                <div\n                  style={{\n                    borderRadius: 10,\n                    width: 10,\n                    height: 10,\n                    backgroundColor: renderRatingToColor(result.rating),\n                    marginRight: 10,\n                    flexShrink: 0,\n                    transform: `translateY(6px)`,\n                  }}\n                />\n                {result?.text && <div dangerouslySetInnerHTML={{__html: result.text}} />}\n              </Flex>\n            ))}\n          </TabPanel>\n        ))}\n      </Flex>\n    </Box>\n  )\n}\n\nSeoPaneComponent.propTypes = {\n  document: PropTypes.shape({\n    displayed: PropTypes.shape({\n      _id: PropTypes.string,\n      _rev: PropTypes.string,\n    }),\n  }).isRequired,\n  options: PropTypes.shape({\n    keywords: PropTypes.oneOfType([PropTypes.string, PropTypes.func]).isRequired,\n    synonyms: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n    url: PropTypes.func.isRequired,\n  }).isRequired,\n}\n\nfunction badOption(key) {\n  throw new Error(`seo-pane options: ${key} is invalid or missing`)\n}\n"],"mappings":"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"}